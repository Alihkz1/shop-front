<div class="d-flex flex-column h-100">
    <div class="page-title">
        {{ 'productDetails' | translate }}
        <div class="page-title-back" (click)="back()">
            <img class="page-title-back-icon" src="assets/svg/back.svg">
            {{ 'back' | translate }}
        </div>
        <div *ngIf="client.isAdmin" class="page-title-crud" (click)="onCrud()">
            <span class="page-title-crud-text px-1">{{ "productCrud" | translate }}</span>
            <img src="assets/svg/product-crud.svg">
        </div>
    </div>
    <div class="wrapper">
        @if (dataLoading && !dataLoading.closed) {
        <loading class="mt-5"></loading>
        }@else {
        <nz-tabset class="my-1">
            <nz-tab nzTitle="اطلاعات">
                <div class="row">
                    <ng-container *ngIf="product?.product.productId; else productDeleted">

                        <!-- product section -->

                        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12">
                            <div class="pt-2 d-flex justify-content-center" dir="ltr">
                                <app-carousel [images]="product?.product.imageUrl"></app-carousel>
                            </div>
                        </div>
                        <div class="col-xl-8 col-lg-8 col-md-6 col-sm-12">
                            <div class="detail mt-4">
                                <div class="detail-title">
                                    {{ product?.product.title }}
                                </div>

                                <div class="detail-price mb-2 mt-4">
                                    <span class="detail-price-title"> <b>{{ 'price' | translate }}:</b> </span>
                                    <span class="mx-2"> {{ product?.product.price | currencyPipe }} {{ 'currency' |
                                        translate }}
                                    </span>
                                </div>

                                @if (product?.product.amount > 0 && product?.productSize.length === 0) {
                                <div class="detail-amount my-2">
                                    <span class="detail-amount-title"> <b>{{ 'amount' | translate }}:</b> </span>
                                    <span class="mx-2"> {{ product?.product.amount }} </span>
                                </div>
                                }

                                <div *ngIf="product?.productSize.length > 0" class="detail-size mt-2 mb-4">
                                    <span class="detail-size-title"> <b>{{ 'selectSize' | translate }}:</b> </span>
                                    <nz-select [formControl]="sizeFormControl" nzAllowClear>
                                        @for (item of product.productSize; track $index) {
                                        <nz-option [nzValue]="item.size" [nzLabel]="item.size"></nz-option>
                                        }
                                    </nz-select>
                                </div>
                            </div>

                            <!-- buttons section -->

                            <ng-container *ngIf="!client.isLogin;else clientIsLogin">
                                <div class="w-100 d-flex justify-content-center">
                                    <button nz-button nzType="default" (click)="navigateToLogin()">
                                        {{ 'getInBeforeBuy' | translate }}
                                    </button>
                                </div>
                            </ng-container>
                            <ng-template #clientIsLogin>
                                <ng-container *ngIf="!client.isAdmin">
                                    <!-- product is in card -->
                                    <ng-container *ngIf="productInShopCardFlag; else productNotInCard">
                                        <div class="w-100 d-flex justify-content-center">
                                            <div class="mx-3 mt-1">
                                                <b>{{ "quantity" | translate }}:</b>
                                            </div>
                                            <nz-button-group>
                                                <button nz-button (click)="minCount()"><span nz-icon
                                                        nzType="minus"></span></button>
                                                <div class="mx-3 mt-1">
                                                    {{ wantToBuyAmount }}
                                                </div>
                                                <button nz-button (click)="addCount()"><span nz-icon
                                                        nzType="plus"></span></button>
                                            </nz-button-group>
                                            <span class="red cursor-pointer delete" nz-icon nzType="delete"
                                                nzTheme="outline" (click)="deleteFromShopCard()">
                                            </span>
                                        </div>
                                    </ng-container>
                                    <!-- product not in card -->
                                    <ng-template #productNotInCard>
                                        <!-- product is available -->
                                        <ng-container
                                            *ngIf="product?.product.amount > 0 || product?.productSize.length !== 0; else notAvailable">
                                            <div class="w-100 d-flex justify-content-center">
                                                <button nz-button nzType="default" (click)="addToCard()"
                                                    [disabled]="product?.productSize.length > 0 && selectedSize === null">
                                                    {{ 'toShopCard' | translate }}
                                                    <span nz-icon nzType="shopping" nzTheme="outline"></span>
                                                </button>
                                            </div>
                                        </ng-container>
                                        <!-- product not available -->
                                        <ng-template #notAvailable>
                                            <div class="red d-flex justify-content-center">
                                                {{ "notAvailable" | translate }}
                                            </div>
                                        </ng-template>
                                    </ng-template>
                                </ng-container>
                            </ng-template>





                        </div>
                    </ng-container>
                    <ng-template #productDeleted>
                        <nz-alert class="d-flex justify-content-center" nzType="error"
                            [nzMessage]="'productHasBeenDeleted' | translate">
                        </nz-alert>
                    </ng-template>
                </div>
            </nz-tab>

            <nz-tab nzTitle="مشخصات">
                <div class="details-wrapper">
                    <p [innerHTML]="product.product.description"></p>
                </div>
            </nz-tab>
            <nz-tab nzTitle="نظرات کاربران">

            </nz-tab>
        </nz-tabset>
        }
    </div>
</div>